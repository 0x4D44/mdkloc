# Code Review Report

## Summary
- Rust CLI for multi-language LOC statistics lives entirely in `src/main.rs` (~114k lines) with extensive counting logic and CLI flags.
- Unit tests cover many language parsers, but CLI behaviors such as recursive filtering lack integration coverage.
- Several implementation choices risk incorrect output or brittle behavior under real workloads.

## Major Findings
- **[High] `--filespec` stops recursion** - In `scan_directory` the `filespec` branch bails out after matching files in the current directory and never descends into children (`src/main.rs:1726`). This contradicts the documented promise to apply the glob "in each directory," so nested matches are silently skipped. Continue walking subdirectories after applying the filter (or restructure around a walker that supports filtered recursion) and add a regression test with a nested fixture.
- **[High] Invalid glob patterns panic the process** - `glob(pattern_str).expect("Failed to read glob pattern ")` (`src/main.rs:1738`) unwraps user input. Any malformed glob or IO error will crash with a panic rather than surfacing a friendly error. Convert the error into an `io::Error` (or logged warning) so the CLI degrades gracefully.
- **[Medium] Line counters load entire files into memory** - `read_file_lines_lossy` collects every line into a `Vec<String>` before counting (`src/main.rs:168-185`). On large repositories this multiplies memory usage and copy costs. Stream lines via `BufRead::read_line`/`lines()` and process them in place to keep memory bounded.
- **[Medium] Inline comments vanish from metrics** - Lines containing both code and a trailing comment are tagged as comment lines (`count_c_style_lines`, `src/main.rs:518-614`), but `normalize_stats` removes those comment counts whenever `code + comment + blank > total_lines` (`src/main.rs:82-102`). Reported comment totals therefore omit inline `//` or `/* */` usage, which diverges from common LOC expectations. Adjust the normalization rule or document the intended semantics.

## Additional Notes
- The entire implementation resides in a single large module; splitting CLI parsing, walkers, and language counters into dedicated submodules would improve readability and testability.
- `unicode-normalization` is declared but unused (`Cargo.toml:8`); either apply it or drop the dependency.
- Documentation still advertises "mdkloc v2.0.0" (`readme.md:1`) while `Cargo.toml` ships version `2.1.0`; align the version story.
- Existing tests exercise `filespec`, but only at the root directory (`src/main.rs:2726-2754`). Add a nested-case test so the recursion bug is caught going forward.
