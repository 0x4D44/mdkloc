# Code Review – mdkloc Repository

## Summary
- Broad feature set and extensive failure-injection tests demonstrate careful attention to edge cases, but I found two correctness gaps (root ignore handling and shell dotfile parsing) that can produce inaccurate results today.
- Documentation currently overstates capabilities (parallel scanning, Unicode normalization) and shows version drift relative to the crate metadata.
- Cleanup opportunities (unused dependency, single-file concentration) will smooth maintenance once the functional fixes land.

## Findings

### Important
- **Auto-ignored root directories** – `scan_directory_impl` exits early whenever `path` matches one of the built-in ignore names (`src/main.rs:2044-2057`). Because the check runs before any depth filtering, explicitly analyzing `mdkloc target` or `mdkloc node_modules` returns an empty report even though the user asked for those directories.  
  **Fix**: Gate the ignore shortcut on `current_depth > 0` (or compare the candidate against the configured root) so only nested directories are auto-skipped. If configurability is desired, reuse the existing `--ignore` logic instead of hard-coding at depth 0.
- **Shell dotfiles counted as generic text** – `get_language_from_extension` maps `.bashrc`, `.bash_profile`, `.profile`, etc. to “Shell” (`src/main.rs:286-294`), yet `count_lines_with_stats` only switches on file extensions (`src/main.rs:523-586`). Unix dotfiles have no extension, so they drop into `count_generic_lines`, and comment lines are erroneously counted as code.  
  **Fix**: Treat the recognized shell dotfiles the same way as Dockerfile/Makefile in the special-name section of `count_lines_with_stats` (call `count_shell_lines` before inspecting extensions).

### Minor
- **Documentation mismatches** – README still promises parallel execution and Unicode normalization (`readme.md:26-31`, `readme.md:51-55`), neither of which exists in `src/main.rs`. Once behavior is corrected, trim or restate those bullets so the marketing copy matches the binary’s capabilities.
- **Version drift in README** – The README title highlights “mdkloc v2.0.0” (`readme.md:1`) while `Cargo.toml` publishes version 2.3.0 (`Cargo.toml:2`). Update the documentation header (and any “What’s New” narrative) to reflect the current crate version after the next release increment.
- **Unused dependency** – `unicode-normalization` remains in `Cargo.toml:8` but is never imported; removing it (and any README references) will reduce compile time and eliminate confusion about Unicode handling.

## Positive Notes
- Robust failure-injection strategy in `scan_directory` tests (metadata/read_dir/entry errors) builds confidence in the traversal error handling.
- Wide language coverage with focused unit tests (HCL/INI/Terraform permutations, classic languages, templating formats) shows diligence toward correctness across many syntaxes.
- Progress reporting, performance summary, and colored output are well-integrated and easy to follow.

## Testing
- `cargo test` *(blocked)* – dependency downloads require network access; the sandbox could not resolve `static.crates.io`, so no automated tests completed locally.
