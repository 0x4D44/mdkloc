# Code Review Plan â€“ mdkloc
Date: 2025-11-18
Author: Codex

## Scope
- Main production code: `src/main.rs`
- Embedded unit tests file: `src/tests_included.rs` (as test helper/reference where relevant)
- Integration/CLI tests: `tests/*.rs`
- Documentation impacting behavior: `readme.md`

## Objectives
- Validate correctness, safety, and edge-case handling of the line-counting and role-aware logic.
- Assess CLI behavior/flags, reporting accuracy, and error handling.
- Check performance implications (I/O, allocation, hot loops).
- Evaluate test quality and coverage for critical paths (especially new role functionality).
- Identify maintainability and observability concerns.

## Review Dimensions & Checklist
1. **API/CLI surface**
   - Flag defaults and aliases (`--role-breakdown` / `-r`), backward compatibility, help text coverage.
   - Output stability (tables, summaries, role sections).
2. **Correctness & Edge Cases**
   - Role inference (path heuristics, attributes) and line-role assignment.
   - Counting per language, normalization, symlink handling, max-depth/max-entries guards.
   - Error reporting vs. silent skips (metadata/read_dir/file_type failures).
3. **Performance**
   - File reading strategy, per-line parsing, allocations; metrics update frequency; role splitting overhead.
4. **Testing & Coverage**
   - Unit and integration coverage for new role-aware paths, reporting, symlink branches.
   - Gaps/untested lines and suggested additions.
5. **Maintainability**
   - Code structure/complexity, duplication, clear responsibilities, future extension points (more languages, JSON output).

## Deliverables
- Comprehensive review report saved to `wrk_docs/YYYY.MM.DD - CR - <desc>.md`.
- Identified issues with severity, implications, and recommended fixes.
- Notes on test coverage gaps and suggested follow-up work.
